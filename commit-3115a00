From 3115a0017ae57308ea6bea03e29f3cd348e8f76b Mon Sep 17 00:00:00 2001
From: "frank@DESKTOP-2J3C6NR" <fkelly12054@gmail.com>
Date: Sun, 22 Nov 2020 09:56:35 -0500
Subject: Signed-off-by: frank@DESKTOP-2J3C6NR <fkelly12054@gmail.com>
 translation and other d9 related changes

Signed-off-by: frank@DESKTOP-2J3C6NR <fkelly12054@gmail.com>

diff --git a/src/JuiceboxFormatter.php b/src/JuiceboxFormatter.php
index 66231b4..f96a1d2 100644
--- a/src/JuiceboxFormatter.php
+++ b/src/JuiceboxFormatter.php
@@ -6,18 +6,20 @@ use Drupal\Core\Messenger\MessengerInterface;
 use Symfony\Component\HttpFoundation\RequestStack;
 use Drupal\Core\Path\CurrentPathStack;
 use Drupal\Core\Config\ConfigFactoryInterface;
-use Drupal\Core\StringTranslation\TranslationInterface;
 use Drupal\Core\Routing\UrlGeneratorInterface;
 use Drupal\Core\Extension\ModuleHandlerInterface;
 use Drupal\Component\Render\FormattableMarkup;
 use Drupal\Component\Utility\Html;
 use Drupal\file\FileInterface;
 use Drupal\image\Entity\ImageStyle;
+use Drupal\Core\StringTranslation\TranslationInterface;
+use Drupal\Core\StringTranslation\StringTranslationTrait;
 
 /**
  * Class to define a Drupal service with common formatter methods.
  */
 class JuiceboxFormatter implements JuiceboxFormatterInterface {
+  use StringTranslationTrait;
 
   /**
    * A Drupal configuration factory service.
@@ -26,13 +28,6 @@ class JuiceboxFormatter implements JuiceboxFormatterInterface {
    */
   protected $configFactory;
 
-  /**
-   * A Drupal string translation service.
-   *
-   * @var \Drupal\Core\StringTranslation\TranslationInterface
-   */
-  protected $stringTranslation;
-
   /**
    * A Drupal URL generator service.
    *
@@ -75,6 +70,7 @@ class JuiceboxFormatter implements JuiceboxFormatterInterface {
    */
   protected $messenger;
 
+
   /**
    * Constructor.
    *
@@ -94,9 +90,9 @@ class JuiceboxFormatter implements JuiceboxFormatterInterface {
    * @param \Drupal\Core\Messenger\MessengerInterface $messenger_interface
    *   The messenger interface.
    */
-  public function __construct(ConfigFactoryInterface $config_factory, TranslationInterface $translation, UrlGeneratorInterface $url_generator, ModuleHandlerInterface $module_manager, CurrentPathStack $currentPathStack, RequestStack $request_stack, MessengerInterface $messenger_interface) {
+  public function __construct(ConfigFactoryInterface $config_factory, TranslationInterface $string_translation, UrlGeneratorInterface $url_generator, ModuleHandlerInterface $module_manager, CurrentPathStack $currentPathStack, RequestStack $request_stack, MessengerInterface $messenger_interface) {
     $this->configFactory = $config_factory;
-    $this->stringTranslation = $translation;
+    $this->stringTranslation = $string_translation;
     $this->urlGenerator = $url_generator;
     $this->moduleManager = $module_manager;
     $this->currentPathStack = $currentPathStack;
@@ -178,7 +174,7 @@ class JuiceboxFormatter implements JuiceboxFormatterInterface {
     if ($global_settings['translate_interface']) {
       $base_string = $global_settings['base_languagelist'];
       if (!empty($base_string)) {
-        $gallery->addOption('languagelist', Html::escape($this->stringTranslation->translate($base_string)), FALSE);
+        $gallery->addOption('languagelist', Html::escape($this->t($base_string)), FALSE);
       }
     }
     // Allow other modules to alter the built gallery data before it's
diff --git a/src/Plugin/Derivative/JuiceboxConfFieldContextualLinks.php b/src/Plugin/Derivative/JuiceboxConfFieldContextualLinks.php
index eff3a8c..c37e639 100644
--- a/src/Plugin/Derivative/JuiceboxConfFieldContextualLinks.php
+++ b/src/Plugin/Derivative/JuiceboxConfFieldContextualLinks.php
@@ -6,12 +6,16 @@ use Drupal\Component\Plugin\Derivative\DeriverBase;
 use Drupal\Core\Plugin\Discovery\ContainerDeriverInterface;
 use Drupal\Core\Entity\EntityTypeManagerInterface;
 use Symfony\Component\DependencyInjection\ContainerInterface;
+use Drupal\Core\StringTranslation\TranslationInterface;
+use Drupal\Core\StringTranslation\StringTranslationTrait;
 
 /**
  * Provides dynamic contextual links for Juicebox field conf editing.
  */
 class JuiceboxConfFieldContextualLinks extends DeriverBase implements ContainerDeriverInterface {
 
+  use StringTranslationTrait;
+
   /**
    * A Drupal entity type manager service.
    *
@@ -24,9 +28,12 @@ class JuiceboxConfFieldContextualLinks extends DeriverBase implements ContainerD
    *
    * @param \Drupal\Core\Entity\EntityTypeManagerInterface $entity_type_manager
    *   The entity type manager service.
+   * @param \Drupal\Core\StringTranslation\TranslationInterface $translation
+   *   A string translation service.
    */
-  public function __construct(EntityTypeManagerInterface $entity_type_manager) {
+  public function __construct(EntityTypeManagerInterface $entity_type_manager, TranslationInterface $string_translation) {
     $this->entityTypeManager = $entity_type_manager;
+    $this->stringTranslation = $string_translation;
   }
 
   /**
@@ -37,7 +44,8 @@ class JuiceboxConfFieldContextualLinks extends DeriverBase implements ContainerD
     // services from the container and inject them into our deriver via its own
     // constructor as needed.
     return new static(
-      $container->get('entity_type.manager')
+      $container->get('entity_type.manager'),
+      $container->get('string_translation')
     );
   }
 
